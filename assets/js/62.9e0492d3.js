(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{504:function(s,n,e){"use strict";e.r(n);var a=e(3),t=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"准备工作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),n("p",[s._v("给Nginx安装SSL模块，好麻烦啊，我的建议是直接安装带有SSL模块的Nginx。")]),s._v(" "),n("p",[s._v("如果你没有SSL模块，那么请跟着我。")]),s._v(" "),n("h3",{attrs:{id:"_1-查找nginx的安装目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-查找nginx的安装目录"}},[s._v("#")]),s._v(" 1.查找Nginx的安装目录")]),s._v(" "),n("p",[s._v("其实就是Nginx的主程序地址，实在找不到可输入以下指令查找目录：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("看到这一句"),n("code",[s._v("00:00:00 nginx: master process /usr/sbin/nginx")]),s._v("。")]),s._v(" "),n("p",[s._v("所以安装的目录为："),n("code",[s._v("/usr/sbin")])]),s._v(" "),n("h3",{attrs:{id:"_2-查看配置文件路径"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-查看配置文件路径"}},[s._v("#")]),s._v(" 2.查看配置文件路径")]),s._v(" "),n("p",[s._v("查找文件nginx.conf，一般就在"),n("code",[s._v("/etc/nginx")]),s._v(",你要是找不到，则输入以下指令查找：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从 /etc 目录下查找文件名为 nginx.conf 的文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" /ect "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-name")]),s._v(" nginx.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"_3-安装ssl模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装ssl模块"}},[s._v("#")]),s._v(" 3.安装SSL模块")]),s._v(" "),n("p",[s._v("需要从别的Nginx安装包里覆盖过来。")]),s._v(" "),n("p",[s._v("首先你挑一个地方用来放新的Nginx包，版本建议选择一致的。")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"},[s._v("提示")]),n("p",[s._v("输入"),n("code",[s._v("nginx -v")]),s._v("可查看你的Nginx版本")])]),n("p",[s._v("请选择中间的那一列的下载地址，找到你的版本右击复制链接即可"),n("a",{attrs:{href:"https://nginx.org/en/download.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx官网"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("code",[s._v("nginx version: nginx/1.18.0 (Ubuntu)")]),s._v("我这里查出版本为1.18.0，所以选择这个版本：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入~目录，这里比较空旷")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://nginx.org/download/nginx-1.18.0.tar.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"},[s._v("提示")]),n("p",[s._v("如果你没有"),n("code",[s._v("wget")]),s._v(",依次输入"),n("code",[s._v("sudo apt update")]),s._v("、"),n("code",[s._v("sudo apt install wget")]),s._v("即可安装")])]),n("p",[s._v("输入"),n("code",[s._v("ls")]),s._v("可以发现目录下红色的安装包。")]),s._v(" "),n("h3",{attrs:{id:"_4-编译以及解决报错"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-编译以及解决报错"}},[s._v("#")]),s._v(" 4.编译以及解决报错")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压它")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xzf")]),s._v(" nginx-1.18.0.tar.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("然后"),n("code",[s._v("cd nginx-1.18.0")]),s._v("进入解压出来的文件夹，输入以下指令：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("./configure --with-http_ssl_module\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("若出现"),n("code",[s._v("checking for C compiler ... not found ./configure: error: C compiler cc is not found")]),s._v("这种报错，则需要先执行"),n("code",[s._v("sudo apt-get install build-essential")])]),s._v(" "),n("p",[s._v("继续执行"),n("code",[s._v("./configure --with-http_ssl_module")]),s._v("，可能会报以下错误,这部分报错参考"),n("a",{attrs:{href:"https://blog.csdn.net/weixin_45729432/article/details/129493752",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./configure: error: the HTTP rewrite module requires the PCRE library.\nYou can either disable the module by using --without-http_rewrite_module\noption, or install the PCRE library into the system, or build the PCRE library\nstatically from the source with nginx by using --with-pcre=<path> option.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("按照提示，我们需要安装"),n("code",[s._v("pcre")]),s._v(",输入以下指令")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libpcre3 libpcre3-dev\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("然后再次执行"),n("code",[s._v("./configure --with-http_ssl_module")]),s._v(",可能会再次报以下错误：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./configure: error: SSL modules require the OpenSSL library.\nYou can either do not enable the modules, or install the OpenSSL library\ninto the system, or build the OpenSSL library statically from the source\nwith nginx by using --with-openssl=<path> option.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("这就是说，系统缺少了"),n("code",[s._v("OpenSSL")]),s._v("库，我们可以执行以下指令尝试安装它：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo apt-get install libssl-dev\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("如果你无法安装"),n("code",[s._v("OpenSSL")]),s._v("，则可以通过使用"),n("code",[s._v("–with-openssl =")]),s._v("选项从源代码构建OpenSSL库,将替换为OpenSSL源代码的路径。即执行:")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("./configure --with-openssl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/src/openssl-1.1.1j\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("再次执行"),n("code",[s._v("./configure --with-http_ssl_module")]),s._v(",可能还会再次报以下错误：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("./configure: error: the HTTP gzip module requires the zlib library.\nYou can either disable the module by using --without-http_gzip_module\noption, or install the zlib library into the system, or build the zlib library\nstatically from the source with nginx by using --with-zlib=<path> option.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("很显然，我们依然缺少了某种东西。这个东西是"),n("code",[s._v("zlib")]),s._v(",执行下列指令:")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" zlib1g\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" zlib1g-dev\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("我到了这里，再次执行"),n("code",[s._v("./configure --with-http_ssl_module")]),s._v("，便不再报错了，您如果还有其他的报错，请参考"),n("a",{attrs:{href:"https://blog.csdn.net/weixin_45729432/article/details/129493752",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("执行下列指令：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("make\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("便可以进行编译，此时目录会出现"),n("code",[s._v("objs")]),s._v("文件夹,若出现以下报错：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cc1: all warnings being treated as errors\nmake[1]: *** [objs/Makefile:842: objs/src/event/ngx_event_openssl.o] Error 1\nmake[1]: Leaving directory '/root/nginx-1.18.0'\nmake: *** [Makefile:8: build] Error\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("解决办法在"),n("a",{attrs:{href:"https://blog.csdn.net/humanyr/article/details/107405310",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("解决完以后，记得回到"),n("code",[s._v("Nginx-1.18.0")]),s._v("这个目录最后重新"),n("code",[s._v("make")]),s._v("就可以啦。")]),s._v(" "),n("h3",{attrs:{id:"_5-覆盖nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-覆盖nginx"}},[s._v("#")]),s._v(" 5.覆盖Nginx")]),s._v(" "),n("p",[s._v("用新的Nginx文件覆盖你之前的老Nginx")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# ./表示当前目录 #/usr/sbin是本文第1步查到的路径，不要弄错了。\ncp ./objs/nginx /usr/sbin\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("若提示"),n("code",[s._v("cp: cannot create regular file '/usr/sbin/nginx': Text file busy")]),s._v(",说明你的Nginx没有停止运行,输入"),n("code",[s._v("nginx -s stop")]),s._v("即可停止。停止以后再次执行"),n("code",[s._v("cp ./objs/nginx /usr/sbin")])]),s._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"title"},[s._v("注意")]),n("p",[s._v("停止和执行"),n("code",[s._v("cp")]),s._v("指令，都不会出现任何提示语句。")])]),n("p",[s._v("这时候，使用下列命令:")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("nginx -V # V需要大写\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("若是出现"),n("code",[s._v("configure arguments: --with-http_ssl_module")]),s._v(",说明你的SSL模块启用了。")]),s._v(" "),n("h2",{attrs:{id:"部署ssl证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署ssl证书"}},[s._v("#")]),s._v(" 部署SSL证书")]),s._v(" "),n("p",[s._v("证书一般可以免费获取，我的域名在腾讯云里面购买，那么可以去腾讯云进行申请1年的免费SSL证书。")]),s._v(" "),n("p",[s._v("申请完，并审核通过以后，可以把证书下载到本地电脑上。")]),s._v(" "),n("p",[s._v("先去你的服务器上，如果你的项目在容器上，那么进入你的容器，进入目录"),n("code",[s._v("/etc/nginx")]),s._v("，使用指令"),n("code",[s._v("mkdir cert")]),s._v("新建"),n("code",[s._v("cert")]),s._v("文件夹。")]),s._v(" "),n("p",[s._v("然后把电脑上下载的证书文件传到这个文件夹里。")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传文件到服务器space里的blog文件夹里")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" xxx.zip space:blog\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("如果你没有配备免密登录，那么把"),n("code",[s._v("space")]),s._v("换成"),n("code",[s._v("root@xxx.xx.xxx.xx")]),s._v(","),n("code",[s._v("root")]),s._v("是你的用户名。")]),s._v(" "),n("p",[s._v("好了，这时候服务器进入"),n("code",[s._v("blog")]),s._v("文件夹，输入"),n("code",[s._v("ls")]),s._v("就可以看到红色字体的zip压缩包。输入"),n("code",[s._v("unzip xxxx.zip")]),s._v("即可解压。解压完成以后进入这个文件夹")]),s._v(" "),n("p",[s._v("我们需要解压出来的"),n("code",[s._v(".pem")]),s._v("、"),n("code",[s._v(".key")]),s._v("这两个文件。把他们传进你之前创建的"),n("code",[s._v("cert")]),s._v("文件夹里")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# blog/xxx，的xxx是你解压证书文件后生成的文件夹")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把里面的.pem传给容器Id为a64221036ee1的/etc/nginx/cert目录下")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" blog/xxx/xxx.pem a64221036ee1/etc/nginx/cert\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 参考指令: docker cp haruka.website_bundle.pem a64221036ee1:/etc/nginx/cert")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传.key文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" blog/xxx/xxx.key a64221036ee1/etc/nginx/cert\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 参考指令：docker cp haruka.website.key a64221036ee1:/etc/nginx/cert")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h2",{attrs:{id:"更新nginx-conf配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新nginx-conf配置"}},[s._v("#")]),s._v(" 更新Nginx.conf配置")]),s._v(" "),n("p",[s._v("进入你的容器,找到"),n("code",[s._v("nginx.conf")]),s._v("文件，它一般在"),n("code",[s._v("/etc/nginx")]),s._v("目录下，如果你是通过导入配置文件进行配置的，那么去你导入的那个配置文件修改即可。")]),s._v(" "),n("p",[s._v("比如我曾在"),n("code",[s._v("nginx.conf")]),s._v("里配置过引入"),n("code",[s._v("include /etc/nginx/configs/*.conf")]),s._v("，那么我只需要进入"),n("code",[s._v("/etc/nginx/configs/")]),s._v("找到对应的配置文件，并进行修改既可以了。")]),s._v(" "),n("p",[s._v("输入"),n("code",[s._v("vim nginx.conf")]),s._v(",修改对应的内容，没有的地方请添加")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器端口使用443，开启ssl, 这里ssl就是上面安装的ssl模块")]),s._v("\n    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 域名，多个以空格分开")]),s._v("\n    server_name  haruka.website blog.haruka.website"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssl证书地址")]),s._v("\n    ssl_certificate     /etc/nginx/cert/haruka.website_bundle.pem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pem文件的路径")]),s._v("\n    ssl_certificate_key  /etc/nginx/cert/haruka.website.key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# key文件的路径")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssl验证相关配置")]),s._v("\n    ssl_session_timeout  5m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缓存有效期")]),s._v("\n    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("NULL:"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("aNULL:"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("MD5:"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("ADH:"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("RC4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#加密算法")]),s._v("\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安全链接可选的加密协议")]),s._v("\n    ssl_prefer_server_ciphers on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用服务器端的首选算法")]),s._v("\n\n    location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        root   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        index  index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下方是为了把http重定向成https")]),s._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    server_name  haruka.website blog.haruka.website"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记得修改成你自己的域名")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" https://"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_name")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("p",[s._v("输入指令"),n("code",[s._v("sudo /etc/init.d/nginx start")]),s._v("启动"),n("code",[s._v("Nginx")]),s._v("，如果失败了，输入"),n("code",[s._v("Nginx -t")]),s._v("查看是否有语法错误。笔者这里出现了这样的错误：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('nginx: [alert] could not open error log file: open() "/usr/local/nginx/logs/error.log" failed (2: No such file or directory)\n2024/03/22 07:42:08 [emerg] 14804#0: open() "/usr/local/nginx/conf/nginx.conf" failed (2: No such file or directory)\nnginx: configuration file /usr/local/nginx/conf/nginx.conf test failed\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("第一项为无法打开"),n("code",[s._v("/usr/local/nginx/logs/error.log")]),s._v(",经过验证，"),n("code",[s._v("local")]),s._v("文件夹下不存在"),n("code",[s._v("nginx")]),s._v("及往后的文件，可能是由于覆盖"),n("code",[s._v("nginx")]),s._v("导致的，解决方式1，新建对应的路径即可。")]),s._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"title"},[s._v("注意")]),n("p",[s._v("在"),n("code",[s._v("logs")]),s._v("文件里，需要新建"),n("code",[s._v("error.log")]),s._v("和"),n("code",[s._v("access.log")]),s._v("两个文件。")])]),n("p",[s._v("第二项,因为我想试图改变nginx找配置的路径，但是失败了，所以使用了软连接的方式，把nginx找的路径，链接到我真实放置"),n("code",[s._v("nginx.conf")]),s._v("的位置。")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /etc/nginx/nginx.conf /usr/local/nginx/conf/nginx.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("好了，试试"),n("code",[s._v("nginx -t")]),s._v("指令吧，如果显示OK,那么恭喜你成功了。接下来只需要输入指令"),n("code",[s._v("sudo /etc/init.d/nginx start")]),s._v("启动"),n("code",[s._v("nginx")]),s._v("就可以了。试试访问你的域名吧！")]),s._v(" "),n("p",[s._v("如果你又出现了这样的报错：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('nginx: [emerg] no "ssl_certificate" is defined for the "listen ... ssl" directive in /etc/nginx/configs/blog.conf:1\nnginx: configuration file /usr/local/nginx/conf/nginx.conf test failed\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("那么，可能你忘记在nginx.conf里配置这些东西了：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server{\n    listen ...\n    ....\n    ssl_certificate     /etc/nginx/cert/haruka.website_bundle.pem;  \n    ssl_certificate_key  /etc/nginx/cert/haruka.website.key; \n\n    ....\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);